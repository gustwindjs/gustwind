function s(){let t=document.querySelector('meta[name="pagepath"]');if(!t){console.error("path element was not found!");return}let o=t.getAttribute("content");if(!o){console.log("pagePath was not found in path element");return}return o}function l(t){let o=document.querySelector("title");o?o.innerHTML=t.title||"":console.warn("The page doesn't have a <title>!"),Object.entries(t).forEach(([c,n])=>{let r=document.head.querySelector("meta[name='"+c+"']");r?r.setAttribute("content",n):console.error("WebSocket","meta element not found for",c)})}function d(t){if(!t)return;let o=new WebSocket("ws://localhost:8080");return o.addEventListener("message",c=>{let n,r;try{let e=JSON.parse(c.data);n=e.type,r=e.payload}catch(e){console.error(c,e);return}if(n==="log")console.log("WebSocket",r);else if(n==="refresh"){console.log("WebSocket","refreshing");let e=document.querySelector("main");if(!e){console.error("Failed to find main");return}e.innerHTML=r.bodyMarkup,l(r.meta),window.createEditor&&window.createEditor()}else if(n==="reload")console.log("Websocket","reloading"),o.send(JSON.stringify({type:"reload",payload:{path:t}}));else if(n==="reloadPage")console.log("Websocket","reloading page"),location.reload();else if(n==="replaceScript"){let{name:e}=r,i=document.querySelector(`script[src="${e}"]`)||document.querySelector(`script[data-script="${e}"]`);if(console.log("Websocket","replacing script"),i){i.remove();let a=document.createElement("script");a.setAttribute("src",e+"?cache="+new Date().getTime()),a.setAttribute("type","module"),a.dataset.script=e,document.body.appendChild(a),window.createEditor&&window.createEditor()}}else console.log("WebSocket","unknown event",c)}),o}if(!("Deno"in globalThis)){let t=d(s());window.developmentSocket=t}
